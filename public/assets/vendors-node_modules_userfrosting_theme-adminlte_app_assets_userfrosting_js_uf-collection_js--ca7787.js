(self["webpackChunk"] = self["webpackChunk"] || []).push([["vendors-node_modules_userfrosting_theme-adminlte_app_assets_userfrosting_js_uf-collection_js--ca7787"],{

/***/ "./node_modules/@userfrosting/theme-adminlte/app/assets/userfrosting/js/uf-collection.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/@userfrosting/theme-adminlte/app/assets/userfrosting/js/uf-collection.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

/* provided dependency */ var jQuery = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/**
 * uf-collection plugin.  Widget for attaching/detaching related items to a single parent item (e.g. roles for a user, etc).
 *
 * === USAGE ===
 *
 * uf-collection can be initialized on a div element as follows:
 *
 * $("#myCollection").ufCollection(options);
 *
 * `options` is an object containing any of the following parameters:
 * @param {bool}   useDropdown Set to true if rows should be added using a select2 dropdown, false for free text inputs (see https://ux.stackexchange.com/a/15637/53990).
 * @param {Object} dropdown The options to pass to the select2 plugin for the add item dropdown.
 * @param {string} dropdown.ajax.url The url from which to fetch options (as JSON data) in the dropdown selector menu.
 * @param {bool}   selectOnClose Set to true if you want the currently highlighted dropdown item to be automatically added when the dropdown is closed for any reason.
 * @param {string} dropdown.theme The select2 theme to use for the dropdown menu.  Defaults to "default".
 * @param {string} dropdown.placeholder Placeholder text to use in the dropdown menu before a selection is made.  Defaults to "Item".
 * @param {string} dropdown.width Width of the dropdown selector, when used.  Defaults to "100%".
 * @param {callback} transformDropdownSelection Custom transformation on objects from the dropdown before passing them to render in the collection table.
 * @param {Object} dropdownControl a jQuery selector specifying the dropdown select2 control.  Defaults to looking for a .js-select-new element inside the parent object.
 * @param {string} dropdownTemplate A Handlebars template to use for rendering the dropdown items.
 * @param {Object} rowContainer a jQuery selector specifying the place where rows should be added.  Defaults to looking for the first tbody element inside the parent object.
 * @param {string} rowTemplate A Handlebars template to use for rendering each row in the table.
 *
 * == EVENTS ==
 *
 * ufCollection triggers the following events:
 *
 * `rowAdd.ufCollection`: triggered when a new row is added to the collection.
 * `rowDelete.ufCollection`: triggered when a row is removed from the collection.
 * `rowTouch.ufCollection`: triggered when any inputs in a row are brought into focus.
 *
 * UserFrosting https://www.userfrosting.com
 * @author Alexander Weissman <https://alexanderweissman.com>
 */
;(function($, window, document, undefined) {
	"use strict";

    // Define plugin name and defaults.
    var pluginName = "ufCollection",
        defaults = {
            useDropdown: true,
            dropdown: {
                ajax        : {
                    url         : "",
                    dataType    : "json",
                    delay       : 250,
                    data        : function (params) {
                        return {
                            filters: {
                                info : params.term
                            }
                        };
                    },
                    processResults  : function (data, params) {
                        // Process the data into dropdown options
                        var suggestions = [];
                        if (data && data.rows) {
                            suggestions = data.rows;
                        }
                        return {
                            results: suggestions
                        };
                    },
                    cache           : true
                },
                placeholder     : "Item",
                selectOnClose   : false,  // Make a selection when they click out of the box/press the next button
                theme           : "default",
                width           : "100%",
            },
            transformDropdownSelection: function (item) {
                return item;
            },
            dropdownControl : null,
            dropdownTemplate: "",
            rowContainer    : null,
            rowTemplate     : "",
            DEBUG           : false
            };

    // Constructor
    function Plugin (element, options) {
        this.element = element[0];
        this.$element = $(this.element);
        var lateDefaults = {
            dropdownControl: this.$element.find('.js-select-new'),
            rowContainer: this.$element.find('tbody').first()
        };
        this.settings = $.extend(true, {}, defaults, lateDefaults, options);
        this._defaults = defaults;
        this._name = pluginName;

        // Detect changes to element attributes
        this.$element.attrchange({ callback: function (event) { this.element = event.target; }.bind(this) });

        // Internal counter for adding rows to the collection.  Gets updated every time `_createRow` is called.
        this._rownum = 0;

        // Keep track of last added row
        this._lastRow = null;

        // Handlebars template method
        this._dropdownTemplateCompiled = Handlebars.compile(this.settings.dropdownTemplate);

        this._rowTemplateCompiled = Handlebars.compile(this.settings.rowTemplate);

        // Add container class
        this.$element.toggleClass("uf-collection", true);

        // Add bindings for any rows already present in the DOM
        $.each(this.settings.rowContainer.find('.uf-collection-row'), $.proxy(function(idx, row) {
            this._onNewRow($(row));
            this._lastRow = row;
        }, this));

        // If we're using dropdown options, create the select2 and add bindings to add a new row when an option is selected
        if (this.settings.useDropdown) {
            this._initDropdownField(this.settings.dropdownControl);

            this.settings.dropdownControl.on("select2:select", $.proxy(function(e) {
                var item = $(e.target).select2("data")[0];
                // Apply any transformations before rendering as a row
                var transformed = this.settings.transformDropdownSelection(item);
                this._createRow(transformed);
            }, this));
        }
        else {
            // Otherwise, add a new virgin row
            this._createVirginRow();
        }

        return this;
    }

    // Functions
    $.extend(Plugin.prototype, {
        /**
         * Add a new row to the collection, optionally passing in prepopulated template data.
         */
        addRow: function(options) {
            // Grab params, if any
            var params = {};
            if (typeof options !== 'undefined') {
                params = options[0];
            }

            this._createRow(params);

            return this.$element;
        },
        /**
         * Add a new 'virgin' row to the collection, optionally passing in prepopulated template data.
         * Virgin rows are rows that have not yet been brought into focus by the user.
         * When a virgin row is brought into focus, it loses its virgin status and a new virgin row is created.
         */
        addVirginRow: function(options) {
            // Grab params, if any
            var params = {};
            if (typeof options !== 'undefined') {
                params = options[0];
            }

            this._createVirginRow(params);

            return this.$element;
        },
        /**
         * Delete a target row.
         */
        deleteRow: function(row) {
            this._deleteRow(row);

            return this.$element;
        },
        /**
         * Get the dropdown control for the collection, if one exists.
         */
        getDropdown: function() {
            return this.settings.dropdownControl;
        },
        /**
         * Get the last row added in the collection.
         */
        getLastRow: function () {
            return this._lastRow;
        },
        /**
         * Touch a target row.
         */
        touchRow: function(row) {
            this._touchRow(row);

            return this.$element;
        },
        /**
         * Create a new row and attach the handler for deletion to the js-delete-row button
         */
        _createRow: function(params) {
            params = $.extend(true,
            {
                id: "",
                rownum: this._rownum
            }, params);

            // Generate the row and append to table
            var newRowTemplate = this._rowTemplateCompiled(params),
                newRow;

            // Add the new row before any virgin rows in the table.
            var virginRows = this.settings.rowContainer.find('.uf-collection-row-virgin').length;
            if (virginRows) {
                newRow = $(newRowTemplate).insertBefore(this.settings.rowContainer.find('.uf-collection-row-virgin:first'));
            } else {
                newRow = $(newRowTemplate).appendTo(this.settings.rowContainer);
            }

            this._lastRow = newRow;

            // Add bindings and fire event
            this._onNewRow(newRow);

            return newRow;
        },
        /**
         * Create a new, blank row with the 'virgin' status.
         */
        _createVirginRow: function(params) {
            // Generate the row and append to table
            var newRow = this._createRow(params);

            // Set the row's 'virgin' status
            newRow.addClass('uf-collection-row-virgin');
            newRow.find('.js-delete-row').hide();

            return newRow;
        },
        /**
         * Delete a row from the collection.
         */
        _deleteRow: function(row) {
            row.remove();
            this.$element.trigger('rowDelete.ufCollection', row);
        },
         /**
         * Add delete and touch bindings for a row, increment the internal row counter, and fire the rowAdd event
         */
        _onNewRow: function(row) {
            // Trigger to delete row
            row.find('.js-delete-row').on('click', $.proxy(function(e) {
                this._deleteRow($(e.target).closest('.uf-collection-row'));
            }, this));

            // Once the new row comes into focus for the first time, it has been "touched"
            row.find(':input').on('focus', $.proxy(function() {
                this._touchRow(row);
            }, this));

            this._rownum += 1;

            // Fire event when row has been constructed
            this.$element.trigger('rowAdd.ufCollection', row);
        },
        /**
         * Remove a row's virgin status, show the delete button, and add a new virgin row if needed
         */
        _touchRow: function(row) {
            row.removeClass('uf-collection-row-virgin');
            row.find('.js-delete-row').show();

            this.$element.trigger('rowTouch.ufCollection', row);

            // If we're not using dropdowns, assert that the table doesn't already have a virgin row.  If not, create a new virgin row.
            if (!this.settings.useDropdown) {
                var virginRows = this.settings.rowContainer.find('.uf-collection-row-virgin').length;
                if (!virginRows) {
                    this._createVirginRow();
                }
            }
        },
        /**
         * Initialize the select2 dropdown for this collection on a specified control element.
         */
        _initDropdownField: function(field) {
            var options = this.settings.dropdown;

            if (!("templateResult" in options)) {
                options.templateResult = $.proxy(function(item) {
                    // Display loading text if the item is marked as "loading"
                    if (item.loading) return item.text;

                    // Must wrap this in a jQuery selector to render as HTML
                    return $(this._dropdownTemplateCompiled(item));
                }, this);
            }
            // Legacy options (<= v4.0.9)
            if ("dataUrl" in this.settings) {
                options.ajax.url = this.settings.dataUrl;
            }
            if ("ajaxDelay" in this.settings) {
                options.ajax.delay = this.settings.ajaxDelay;
            }
            if ("dropdownTheme" in this.settings) {
                options.theme = this.settings.dropdownTheme;
            }
            if ("placeholder" in this.settings) {
                options.placeholder = this.settings.placeholder;
            }
            if ("selectOnClose" in this.settings) {
                options.selectOnClose = this.settings.selectOnClose;
            }
            if ("width" in this.settings) {
                options.width = this.settings.width;
            }

            return field.select2(options);
        }
    });

    // Handles instantiation and access to non-private methods.
    $.fn[pluginName] = function(methodOrOptions) {
        // Grab plugin instance
        var instance = $(this).data(pluginName);
        // If undefined or object, initialize plugin.
        if (methodOrOptions === undefined || typeof methodOrOptions === 'object') {
            // Only initialize if not previously done.
            if (!instance) {
                $(this).data(pluginName, new Plugin(this, methodOrOptions));
            }
            return this;
        }
        // Otherwise ensure first parameter is a valid string, and is the name of an actual function.
        else if (typeof methodOrOptions === 'string' && typeof instance[methodOrOptions] === 'function') {
            // Ensure not a private function
            if (methodOrOptions.indexOf('_') !== 0) {
                return instance[methodOrOptions]( Array.prototype.slice.call(arguments, 1));
            }
            else {
                console.warn( 'Method ' +  methodOrOptions + ' is private!' );
            }
        }
        else {
            console.warn( 'Method ' +  methodOrOptions + ' does not exist.' );
        }
    };
})(jQuery, window, document);


/***/ }),

/***/ "./node_modules/@userfrosting/theme-adminlte/app/assets/userfrosting/css/uf-collection.css":
/*!*************************************************************************************************!*\
  !*** ./node_modules/@userfrosting/theme-adminlte/app/assets/userfrosting/css/uf-collection.css ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdXNlcmZyb3N0aW5nX3RoZW1lLWFkbWlubHRlX2FwcF9hc3NldHNfdXNlcmZyb3N0aW5nX2pzX3VmLWNvbGxlY3Rpb25fanMtLWNhNzc4Ny5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CLFdBQVcsUUFBUTtBQUNuQixXQUFXLFVBQVU7QUFDckIsV0FBVyxRQUFRO0FBQ25CLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTs7QUFFQTtBQUNBLG1DQUFtQyw2QkFBNkIsOEJBQThCLGFBQWE7O0FBRTNHO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLEVBQUUsTUFBTTs7Ozs7Ozs7Ozs7OztBQ3hWVCIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AdXNlcmZyb3N0aW5nL3RoZW1lLWFkbWlubHRlL2FwcC9hc3NldHMvdXNlcmZyb3N0aW5nL2pzL3VmLWNvbGxlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0B1c2VyZnJvc3RpbmcvdGhlbWUtYWRtaW5sdGUvYXBwL2Fzc2V0cy91c2VyZnJvc3RpbmcvY3NzL3VmLWNvbGxlY3Rpb24uY3NzPzZkNjYiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiB1Zi1jb2xsZWN0aW9uIHBsdWdpbi4gIFdpZGdldCBmb3IgYXR0YWNoaW5nL2RldGFjaGluZyByZWxhdGVkIGl0ZW1zIHRvIGEgc2luZ2xlIHBhcmVudCBpdGVtIChlLmcuIHJvbGVzIGZvciBhIHVzZXIsIGV0YykuXG4gKlxuICogPT09IFVTQUdFID09PVxuICpcbiAqIHVmLWNvbGxlY3Rpb24gY2FuIGJlIGluaXRpYWxpemVkIG9uIGEgZGl2IGVsZW1lbnQgYXMgZm9sbG93czpcbiAqXG4gKiAkKFwiI215Q29sbGVjdGlvblwiKS51ZkNvbGxlY3Rpb24ob3B0aW9ucyk7XG4gKlxuICogYG9wdGlvbnNgIGlzIGFuIG9iamVjdCBjb250YWluaW5nIGFueSBvZiB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6XG4gKiBAcGFyYW0ge2Jvb2x9ICAgdXNlRHJvcGRvd24gU2V0IHRvIHRydWUgaWYgcm93cyBzaG91bGQgYmUgYWRkZWQgdXNpbmcgYSBzZWxlY3QyIGRyb3Bkb3duLCBmYWxzZSBmb3IgZnJlZSB0ZXh0IGlucHV0cyAoc2VlIGh0dHBzOi8vdXguc3RhY2tleGNoYW5nZS5jb20vYS8xNTYzNy81Mzk5MCkuXG4gKiBAcGFyYW0ge09iamVjdH0gZHJvcGRvd24gVGhlIG9wdGlvbnMgdG8gcGFzcyB0byB0aGUgc2VsZWN0MiBwbHVnaW4gZm9yIHRoZSBhZGQgaXRlbSBkcm9wZG93bi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkcm9wZG93bi5hamF4LnVybCBUaGUgdXJsIGZyb20gd2hpY2ggdG8gZmV0Y2ggb3B0aW9ucyAoYXMgSlNPTiBkYXRhKSBpbiB0aGUgZHJvcGRvd24gc2VsZWN0b3IgbWVudS5cbiAqIEBwYXJhbSB7Ym9vbH0gICBzZWxlY3RPbkNsb3NlIFNldCB0byB0cnVlIGlmIHlvdSB3YW50IHRoZSBjdXJyZW50bHkgaGlnaGxpZ2h0ZWQgZHJvcGRvd24gaXRlbSB0byBiZSBhdXRvbWF0aWNhbGx5IGFkZGVkIHdoZW4gdGhlIGRyb3Bkb3duIGlzIGNsb3NlZCBmb3IgYW55IHJlYXNvbi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkcm9wZG93bi50aGVtZSBUaGUgc2VsZWN0MiB0aGVtZSB0byB1c2UgZm9yIHRoZSBkcm9wZG93biBtZW51LiAgRGVmYXVsdHMgdG8gXCJkZWZhdWx0XCIuXG4gKiBAcGFyYW0ge3N0cmluZ30gZHJvcGRvd24ucGxhY2Vob2xkZXIgUGxhY2Vob2xkZXIgdGV4dCB0byB1c2UgaW4gdGhlIGRyb3Bkb3duIG1lbnUgYmVmb3JlIGEgc2VsZWN0aW9uIGlzIG1hZGUuICBEZWZhdWx0cyB0byBcIkl0ZW1cIi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkcm9wZG93bi53aWR0aCBXaWR0aCBvZiB0aGUgZHJvcGRvd24gc2VsZWN0b3IsIHdoZW4gdXNlZC4gIERlZmF1bHRzIHRvIFwiMTAwJVwiLlxuICogQHBhcmFtIHtjYWxsYmFja30gdHJhbnNmb3JtRHJvcGRvd25TZWxlY3Rpb24gQ3VzdG9tIHRyYW5zZm9ybWF0aW9uIG9uIG9iamVjdHMgZnJvbSB0aGUgZHJvcGRvd24gYmVmb3JlIHBhc3NpbmcgdGhlbSB0byByZW5kZXIgaW4gdGhlIGNvbGxlY3Rpb24gdGFibGUuXG4gKiBAcGFyYW0ge09iamVjdH0gZHJvcGRvd25Db250cm9sIGEgalF1ZXJ5IHNlbGVjdG9yIHNwZWNpZnlpbmcgdGhlIGRyb3Bkb3duIHNlbGVjdDIgY29udHJvbC4gIERlZmF1bHRzIHRvIGxvb2tpbmcgZm9yIGEgLmpzLXNlbGVjdC1uZXcgZWxlbWVudCBpbnNpZGUgdGhlIHBhcmVudCBvYmplY3QuXG4gKiBAcGFyYW0ge3N0cmluZ30gZHJvcGRvd25UZW1wbGF0ZSBBIEhhbmRsZWJhcnMgdGVtcGxhdGUgdG8gdXNlIGZvciByZW5kZXJpbmcgdGhlIGRyb3Bkb3duIGl0ZW1zLlxuICogQHBhcmFtIHtPYmplY3R9IHJvd0NvbnRhaW5lciBhIGpRdWVyeSBzZWxlY3RvciBzcGVjaWZ5aW5nIHRoZSBwbGFjZSB3aGVyZSByb3dzIHNob3VsZCBiZSBhZGRlZC4gIERlZmF1bHRzIHRvIGxvb2tpbmcgZm9yIHRoZSBmaXJzdCB0Ym9keSBlbGVtZW50IGluc2lkZSB0aGUgcGFyZW50IG9iamVjdC5cbiAqIEBwYXJhbSB7c3RyaW5nfSByb3dUZW1wbGF0ZSBBIEhhbmRsZWJhcnMgdGVtcGxhdGUgdG8gdXNlIGZvciByZW5kZXJpbmcgZWFjaCByb3cgaW4gdGhlIHRhYmxlLlxuICpcbiAqID09IEVWRU5UUyA9PVxuICpcbiAqIHVmQ29sbGVjdGlvbiB0cmlnZ2VycyB0aGUgZm9sbG93aW5nIGV2ZW50czpcbiAqXG4gKiBgcm93QWRkLnVmQ29sbGVjdGlvbmA6IHRyaWdnZXJlZCB3aGVuIGEgbmV3IHJvdyBpcyBhZGRlZCB0byB0aGUgY29sbGVjdGlvbi5cbiAqIGByb3dEZWxldGUudWZDb2xsZWN0aW9uYDogdHJpZ2dlcmVkIHdoZW4gYSByb3cgaXMgcmVtb3ZlZCBmcm9tIHRoZSBjb2xsZWN0aW9uLlxuICogYHJvd1RvdWNoLnVmQ29sbGVjdGlvbmA6IHRyaWdnZXJlZCB3aGVuIGFueSBpbnB1dHMgaW4gYSByb3cgYXJlIGJyb3VnaHQgaW50byBmb2N1cy5cbiAqXG4gKiBVc2VyRnJvc3RpbmcgaHR0cHM6Ly93d3cudXNlcmZyb3N0aW5nLmNvbVxuICogQGF1dGhvciBBbGV4YW5kZXIgV2Vpc3NtYW4gPGh0dHBzOi8vYWxleGFuZGVyd2Vpc3NtYW4uY29tPlxuICovXG47KGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vIERlZmluZSBwbHVnaW4gbmFtZSBhbmQgZGVmYXVsdHMuXG4gICAgdmFyIHBsdWdpbk5hbWUgPSBcInVmQ29sbGVjdGlvblwiLFxuICAgICAgICBkZWZhdWx0cyA9IHtcbiAgICAgICAgICAgIHVzZURyb3Bkb3duOiB0cnVlLFxuICAgICAgICAgICAgZHJvcGRvd246IHtcbiAgICAgICAgICAgICAgICBhamF4ICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsICAgICAgICAgOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZSAgICA6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgICBkZWxheSAgICAgICA6IDI1MCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YSAgICAgICAgOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA6IHBhcmFtcy50ZXJtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Jlc3VsdHMgIDogZnVuY3Rpb24gKGRhdGEsIHBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgZGF0YSBpbnRvIGRyb3Bkb3duIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWdnZXN0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5yb3dzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBkYXRhLnJvd3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IHN1Z2dlc3Rpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjYWNoZSAgICAgICAgICAgOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlciAgICAgOiBcIkl0ZW1cIixcbiAgICAgICAgICAgICAgICBzZWxlY3RPbkNsb3NlICAgOiBmYWxzZSwgIC8vIE1ha2UgYSBzZWxlY3Rpb24gd2hlbiB0aGV5IGNsaWNrIG91dCBvZiB0aGUgYm94L3ByZXNzIHRoZSBuZXh0IGJ1dHRvblxuICAgICAgICAgICAgICAgIHRoZW1lICAgICAgICAgICA6IFwiZGVmYXVsdFwiLFxuICAgICAgICAgICAgICAgIHdpZHRoICAgICAgICAgICA6IFwiMTAwJVwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRyYW5zZm9ybURyb3Bkb3duU2VsZWN0aW9uOiBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRyb3Bkb3duQ29udHJvbCA6IG51bGwsXG4gICAgICAgICAgICBkcm9wZG93blRlbXBsYXRlOiBcIlwiLFxuICAgICAgICAgICAgcm93Q29udGFpbmVyICAgIDogbnVsbCxcbiAgICAgICAgICAgIHJvd1RlbXBsYXRlICAgICA6IFwiXCIsXG4gICAgICAgICAgICBERUJVRyAgICAgICAgICAgOiBmYWxzZVxuICAgICAgICAgICAgfTtcblxuICAgIC8vIENvbnN0cnVjdG9yXG4gICAgZnVuY3Rpb24gUGx1Z2luIChlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnRbMF07XG4gICAgICAgIHRoaXMuJGVsZW1lbnQgPSAkKHRoaXMuZWxlbWVudCk7XG4gICAgICAgIHZhciBsYXRlRGVmYXVsdHMgPSB7XG4gICAgICAgICAgICBkcm9wZG93bkNvbnRyb2w6IHRoaXMuJGVsZW1lbnQuZmluZCgnLmpzLXNlbGVjdC1uZXcnKSxcbiAgICAgICAgICAgIHJvd0NvbnRhaW5lcjogdGhpcy4kZWxlbWVudC5maW5kKCd0Ym9keScpLmZpcnN0KClcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgbGF0ZURlZmF1bHRzLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5fZGVmYXVsdHMgPSBkZWZhdWx0cztcbiAgICAgICAgdGhpcy5fbmFtZSA9IHBsdWdpbk5hbWU7XG5cbiAgICAgICAgLy8gRGV0ZWN0IGNoYW5nZXMgdG8gZWxlbWVudCBhdHRyaWJ1dGVzXG4gICAgICAgIHRoaXMuJGVsZW1lbnQuYXR0cmNoYW5nZSh7IGNhbGxiYWNrOiBmdW5jdGlvbiAoZXZlbnQpIHsgdGhpcy5lbGVtZW50ID0gZXZlbnQudGFyZ2V0OyB9LmJpbmQodGhpcykgfSk7XG5cbiAgICAgICAgLy8gSW50ZXJuYWwgY291bnRlciBmb3IgYWRkaW5nIHJvd3MgdG8gdGhlIGNvbGxlY3Rpb24uICBHZXRzIHVwZGF0ZWQgZXZlcnkgdGltZSBgX2NyZWF0ZVJvd2AgaXMgY2FsbGVkLlxuICAgICAgICB0aGlzLl9yb3dudW0gPSAwO1xuXG4gICAgICAgIC8vIEtlZXAgdHJhY2sgb2YgbGFzdCBhZGRlZCByb3dcbiAgICAgICAgdGhpcy5fbGFzdFJvdyA9IG51bGw7XG5cbiAgICAgICAgLy8gSGFuZGxlYmFycyB0ZW1wbGF0ZSBtZXRob2RcbiAgICAgICAgdGhpcy5fZHJvcGRvd25UZW1wbGF0ZUNvbXBpbGVkID0gSGFuZGxlYmFycy5jb21waWxlKHRoaXMuc2V0dGluZ3MuZHJvcGRvd25UZW1wbGF0ZSk7XG5cbiAgICAgICAgdGhpcy5fcm93VGVtcGxhdGVDb21waWxlZCA9IEhhbmRsZWJhcnMuY29tcGlsZSh0aGlzLnNldHRpbmdzLnJvd1RlbXBsYXRlKTtcblxuICAgICAgICAvLyBBZGQgY29udGFpbmVyIGNsYXNzXG4gICAgICAgIHRoaXMuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoXCJ1Zi1jb2xsZWN0aW9uXCIsIHRydWUpO1xuXG4gICAgICAgIC8vIEFkZCBiaW5kaW5ncyBmb3IgYW55IHJvd3MgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBET01cbiAgICAgICAgJC5lYWNoKHRoaXMuc2V0dGluZ3Mucm93Q29udGFpbmVyLmZpbmQoJy51Zi1jb2xsZWN0aW9uLXJvdycpLCAkLnByb3h5KGZ1bmN0aW9uKGlkeCwgcm93KSB7XG4gICAgICAgICAgICB0aGlzLl9vbk5ld1JvdygkKHJvdykpO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFJvdyA9IHJvdztcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIC8vIElmIHdlJ3JlIHVzaW5nIGRyb3Bkb3duIG9wdGlvbnMsIGNyZWF0ZSB0aGUgc2VsZWN0MiBhbmQgYWRkIGJpbmRpbmdzIHRvIGFkZCBhIG5ldyByb3cgd2hlbiBhbiBvcHRpb24gaXMgc2VsZWN0ZWRcbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MudXNlRHJvcGRvd24pIHtcbiAgICAgICAgICAgIHRoaXMuX2luaXREcm9wZG93bkZpZWxkKHRoaXMuc2V0dGluZ3MuZHJvcGRvd25Db250cm9sKTtcblxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5kcm9wZG93bkNvbnRyb2wub24oXCJzZWxlY3QyOnNlbGVjdFwiLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQoZS50YXJnZXQpLnNlbGVjdDIoXCJkYXRhXCIpWzBdO1xuICAgICAgICAgICAgICAgIC8vIEFwcGx5IGFueSB0cmFuc2Zvcm1hdGlvbnMgYmVmb3JlIHJlbmRlcmluZyBhcyBhIHJvd1xuICAgICAgICAgICAgICAgIHZhciB0cmFuc2Zvcm1lZCA9IHRoaXMuc2V0dGluZ3MudHJhbnNmb3JtRHJvcGRvd25TZWxlY3Rpb24oaXRlbSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlUm93KHRyYW5zZm9ybWVkKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgYWRkIGEgbmV3IHZpcmdpbiByb3dcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVZpcmdpblJvdygpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLy8gRnVuY3Rpb25zXG4gICAgJC5leHRlbmQoUGx1Z2luLnByb3RvdHlwZSwge1xuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGEgbmV3IHJvdyB0byB0aGUgY29sbGVjdGlvbiwgb3B0aW9uYWxseSBwYXNzaW5nIGluIHByZXBvcHVsYXRlZCB0ZW1wbGF0ZSBkYXRhLlxuICAgICAgICAgKi9cbiAgICAgICAgYWRkUm93OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICAvLyBHcmFiIHBhcmFtcywgaWYgYW55XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge307XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gb3B0aW9uc1swXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlUm93KHBhcmFtcyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbGVtZW50O1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGEgbmV3ICd2aXJnaW4nIHJvdyB0byB0aGUgY29sbGVjdGlvbiwgb3B0aW9uYWxseSBwYXNzaW5nIGluIHByZXBvcHVsYXRlZCB0ZW1wbGF0ZSBkYXRhLlxuICAgICAgICAgKiBWaXJnaW4gcm93cyBhcmUgcm93cyB0aGF0IGhhdmUgbm90IHlldCBiZWVuIGJyb3VnaHQgaW50byBmb2N1cyBieSB0aGUgdXNlci5cbiAgICAgICAgICogV2hlbiBhIHZpcmdpbiByb3cgaXMgYnJvdWdodCBpbnRvIGZvY3VzLCBpdCBsb3NlcyBpdHMgdmlyZ2luIHN0YXR1cyBhbmQgYSBuZXcgdmlyZ2luIHJvdyBpcyBjcmVhdGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgYWRkVmlyZ2luUm93OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICAvLyBHcmFiIHBhcmFtcywgaWYgYW55XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge307XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gb3B0aW9uc1swXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlVmlyZ2luUm93KHBhcmFtcyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbGVtZW50O1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlIGEgdGFyZ2V0IHJvdy5cbiAgICAgICAgICovXG4gICAgICAgIGRlbGV0ZVJvdzogZnVuY3Rpb24ocm93KSB7XG4gICAgICAgICAgICB0aGlzLl9kZWxldGVSb3cocm93KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsZW1lbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgdGhlIGRyb3Bkb3duIGNvbnRyb2wgZm9yIHRoZSBjb2xsZWN0aW9uLCBpZiBvbmUgZXhpc3RzLlxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0RHJvcGRvd246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3MuZHJvcGRvd25Db250cm9sO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSBsYXN0IHJvdyBhZGRlZCBpbiB0aGUgY29sbGVjdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIGdldExhc3RSb3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXN0Um93O1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogVG91Y2ggYSB0YXJnZXQgcm93LlxuICAgICAgICAgKi9cbiAgICAgICAgdG91Y2hSb3c6IGZ1bmN0aW9uKHJvdykge1xuICAgICAgICAgICAgdGhpcy5fdG91Y2hSb3cocm93KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsZW1lbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBuZXcgcm93IGFuZCBhdHRhY2ggdGhlIGhhbmRsZXIgZm9yIGRlbGV0aW9uIHRvIHRoZSBqcy1kZWxldGUtcm93IGJ1dHRvblxuICAgICAgICAgKi9cbiAgICAgICAgX2NyZWF0ZVJvdzogZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICAgICAgICBwYXJhbXMgPSAkLmV4dGVuZCh0cnVlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcIlwiLFxuICAgICAgICAgICAgICAgIHJvd251bTogdGhpcy5fcm93bnVtXG4gICAgICAgICAgICB9LCBwYXJhbXMpO1xuXG4gICAgICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgcm93IGFuZCBhcHBlbmQgdG8gdGFibGVcbiAgICAgICAgICAgIHZhciBuZXdSb3dUZW1wbGF0ZSA9IHRoaXMuX3Jvd1RlbXBsYXRlQ29tcGlsZWQocGFyYW1zKSxcbiAgICAgICAgICAgICAgICBuZXdSb3c7XG5cbiAgICAgICAgICAgIC8vIEFkZCB0aGUgbmV3IHJvdyBiZWZvcmUgYW55IHZpcmdpbiByb3dzIGluIHRoZSB0YWJsZS5cbiAgICAgICAgICAgIHZhciB2aXJnaW5Sb3dzID0gdGhpcy5zZXR0aW5ncy5yb3dDb250YWluZXIuZmluZCgnLnVmLWNvbGxlY3Rpb24tcm93LXZpcmdpbicpLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICh2aXJnaW5Sb3dzKSB7XG4gICAgICAgICAgICAgICAgbmV3Um93ID0gJChuZXdSb3dUZW1wbGF0ZSkuaW5zZXJ0QmVmb3JlKHRoaXMuc2V0dGluZ3Mucm93Q29udGFpbmVyLmZpbmQoJy51Zi1jb2xsZWN0aW9uLXJvdy12aXJnaW46Zmlyc3QnKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld1JvdyA9ICQobmV3Um93VGVtcGxhdGUpLmFwcGVuZFRvKHRoaXMuc2V0dGluZ3Mucm93Q29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fbGFzdFJvdyA9IG5ld1JvdztcblxuICAgICAgICAgICAgLy8gQWRkIGJpbmRpbmdzIGFuZCBmaXJlIGV2ZW50XG4gICAgICAgICAgICB0aGlzLl9vbk5ld1JvdyhuZXdSb3cpO1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3Um93O1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogQ3JlYXRlIGEgbmV3LCBibGFuayByb3cgd2l0aCB0aGUgJ3Zpcmdpbicgc3RhdHVzLlxuICAgICAgICAgKi9cbiAgICAgICAgX2NyZWF0ZVZpcmdpblJvdzogZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgcm93IGFuZCBhcHBlbmQgdG8gdGFibGVcbiAgICAgICAgICAgIHZhciBuZXdSb3cgPSB0aGlzLl9jcmVhdGVSb3cocGFyYW1zKTtcblxuICAgICAgICAgICAgLy8gU2V0IHRoZSByb3cncyAndmlyZ2luJyBzdGF0dXNcbiAgICAgICAgICAgIG5ld1Jvdy5hZGRDbGFzcygndWYtY29sbGVjdGlvbi1yb3ctdmlyZ2luJyk7XG4gICAgICAgICAgICBuZXdSb3cuZmluZCgnLmpzLWRlbGV0ZS1yb3cnKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXdSb3c7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWxldGUgYSByb3cgZnJvbSB0aGUgY29sbGVjdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIF9kZWxldGVSb3c6IGZ1bmN0aW9uKHJvdykge1xuICAgICAgICAgICAgcm93LnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdyb3dEZWxldGUudWZDb2xsZWN0aW9uJywgcm93KTtcbiAgICAgICAgfSxcbiAgICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZGVsZXRlIGFuZCB0b3VjaCBiaW5kaW5ncyBmb3IgYSByb3csIGluY3JlbWVudCB0aGUgaW50ZXJuYWwgcm93IGNvdW50ZXIsIGFuZCBmaXJlIHRoZSByb3dBZGQgZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIF9vbk5ld1JvdzogZnVuY3Rpb24ocm93KSB7XG4gICAgICAgICAgICAvLyBUcmlnZ2VyIHRvIGRlbGV0ZSByb3dcbiAgICAgICAgICAgIHJvdy5maW5kKCcuanMtZGVsZXRlLXJvdycpLm9uKCdjbGljaycsICQucHJveHkoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZVJvdygkKGUudGFyZ2V0KS5jbG9zZXN0KCcudWYtY29sbGVjdGlvbi1yb3cnKSk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgIC8vIE9uY2UgdGhlIG5ldyByb3cgY29tZXMgaW50byBmb2N1cyBmb3IgdGhlIGZpcnN0IHRpbWUsIGl0IGhhcyBiZWVuIFwidG91Y2hlZFwiXG4gICAgICAgICAgICByb3cuZmluZCgnOmlucHV0Jykub24oJ2ZvY3VzJywgJC5wcm94eShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3VjaFJvdyhyb3cpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICB0aGlzLl9yb3dudW0gKz0gMTtcblxuICAgICAgICAgICAgLy8gRmlyZSBldmVudCB3aGVuIHJvdyBoYXMgYmVlbiBjb25zdHJ1Y3RlZFxuICAgICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdyb3dBZGQudWZDb2xsZWN0aW9uJywgcm93KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZSBhIHJvdydzIHZpcmdpbiBzdGF0dXMsIHNob3cgdGhlIGRlbGV0ZSBidXR0b24sIGFuZCBhZGQgYSBuZXcgdmlyZ2luIHJvdyBpZiBuZWVkZWRcbiAgICAgICAgICovXG4gICAgICAgIF90b3VjaFJvdzogZnVuY3Rpb24ocm93KSB7XG4gICAgICAgICAgICByb3cucmVtb3ZlQ2xhc3MoJ3VmLWNvbGxlY3Rpb24tcm93LXZpcmdpbicpO1xuICAgICAgICAgICAgcm93LmZpbmQoJy5qcy1kZWxldGUtcm93Jykuc2hvdygpO1xuXG4gICAgICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoJ3Jvd1RvdWNoLnVmQ29sbGVjdGlvbicsIHJvdyk7XG5cbiAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCB1c2luZyBkcm9wZG93bnMsIGFzc2VydCB0aGF0IHRoZSB0YWJsZSBkb2Vzbid0IGFscmVhZHkgaGF2ZSBhIHZpcmdpbiByb3cuICBJZiBub3QsIGNyZWF0ZSBhIG5ldyB2aXJnaW4gcm93LlxuICAgICAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLnVzZURyb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZpcmdpblJvd3MgPSB0aGlzLnNldHRpbmdzLnJvd0NvbnRhaW5lci5maW5kKCcudWYtY29sbGVjdGlvbi1yb3ctdmlyZ2luJykubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICghdmlyZ2luUm93cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVWaXJnaW5Sb3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIHRoZSBzZWxlY3QyIGRyb3Bkb3duIGZvciB0aGlzIGNvbGxlY3Rpb24gb24gYSBzcGVjaWZpZWQgY29udHJvbCBlbGVtZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgX2luaXREcm9wZG93bkZpZWxkOiBmdW5jdGlvbihmaWVsZCkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLnNldHRpbmdzLmRyb3Bkb3duO1xuXG4gICAgICAgICAgICBpZiAoIShcInRlbXBsYXRlUmVzdWx0XCIgaW4gb3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRlbXBsYXRlUmVzdWx0ID0gJC5wcm94eShmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgbG9hZGluZyB0ZXh0IGlmIHRoZSBpdGVtIGlzIG1hcmtlZCBhcyBcImxvYWRpbmdcIlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5sb2FkaW5nKSByZXR1cm4gaXRlbS50ZXh0O1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIE11c3Qgd3JhcCB0aGlzIGluIGEgalF1ZXJ5IHNlbGVjdG9yIHRvIHJlbmRlciBhcyBIVE1MXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMuX2Ryb3Bkb3duVGVtcGxhdGVDb21waWxlZChpdGVtKSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBMZWdhY3kgb3B0aW9ucyAoPD0gdjQuMC45KVxuICAgICAgICAgICAgaWYgKFwiZGF0YVVybFwiIGluIHRoaXMuc2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFqYXgudXJsID0gdGhpcy5zZXR0aW5ncy5kYXRhVXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFwiYWpheERlbGF5XCIgaW4gdGhpcy5zZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuYWpheC5kZWxheSA9IHRoaXMuc2V0dGluZ3MuYWpheERlbGF5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFwiZHJvcGRvd25UaGVtZVwiIGluIHRoaXMuc2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRoZW1lID0gdGhpcy5zZXR0aW5ncy5kcm9wZG93blRoZW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFwicGxhY2Vob2xkZXJcIiBpbiB0aGlzLnNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wbGFjZWhvbGRlciA9IHRoaXMuc2V0dGluZ3MucGxhY2Vob2xkZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoXCJzZWxlY3RPbkNsb3NlXCIgaW4gdGhpcy5zZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2VsZWN0T25DbG9zZSA9IHRoaXMuc2V0dGluZ3Muc2VsZWN0T25DbG9zZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChcIndpZHRoXCIgaW4gdGhpcy5zZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSB0aGlzLnNldHRpbmdzLndpZHRoO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmllbGQuc2VsZWN0MihvcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gSGFuZGxlcyBpbnN0YW50aWF0aW9uIGFuZCBhY2Nlc3MgdG8gbm9uLXByaXZhdGUgbWV0aG9kcy5cbiAgICAkLmZuW3BsdWdpbk5hbWVdID0gZnVuY3Rpb24obWV0aG9kT3JPcHRpb25zKSB7XG4gICAgICAgIC8vIEdyYWIgcGx1Z2luIGluc3RhbmNlXG4gICAgICAgIHZhciBpbnN0YW5jZSA9ICQodGhpcykuZGF0YShwbHVnaW5OYW1lKTtcbiAgICAgICAgLy8gSWYgdW5kZWZpbmVkIG9yIG9iamVjdCwgaW5pdGlhbGl6ZSBwbHVnaW4uXG4gICAgICAgIGlmIChtZXRob2RPck9wdGlvbnMgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0aG9kT3JPcHRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgLy8gT25seSBpbml0aWFsaXplIGlmIG5vdCBwcmV2aW91c2x5IGRvbmUuXG4gICAgICAgICAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5kYXRhKHBsdWdpbk5hbWUsIG5ldyBQbHVnaW4odGhpcywgbWV0aG9kT3JPcHRpb25zKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICAvLyBPdGhlcndpc2UgZW5zdXJlIGZpcnN0IHBhcmFtZXRlciBpcyBhIHZhbGlkIHN0cmluZywgYW5kIGlzIHRoZSBuYW1lIG9mIGFuIGFjdHVhbCBmdW5jdGlvbi5cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIG1ldGhvZE9yT3B0aW9ucyA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGluc3RhbmNlW21ldGhvZE9yT3B0aW9uc10gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIC8vIEVuc3VyZSBub3QgYSBwcml2YXRlIGZ1bmN0aW9uXG4gICAgICAgICAgICBpZiAobWV0aG9kT3JPcHRpb25zLmluZGV4T2YoJ18nKSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZVttZXRob2RPck9wdGlvbnNdKCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggJ01ldGhvZCAnICsgIG1ldGhvZE9yT3B0aW9ucyArICcgaXMgcHJpdmF0ZSEnICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oICdNZXRob2QgJyArICBtZXRob2RPck9wdGlvbnMgKyAnIGRvZXMgbm90IGV4aXN0LicgKTtcbiAgICAgICAgfVxuICAgIH07XG59KShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQpO1xuIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9